<div class="highlight"><pre><a name="impress-new.py-pyg.html-1"></a><span class="kn">from</span> <span class="nn">dexy.filter</span> <span class="kn">import</span> <span class="n">DexyFilter</span>
<a name="impress-new.py-pyg.html-2"></a><span class="kn">import</span> <span class="nn">markdown</span>
<a name="impress-new.py-pyg.html-3"></a><span class="kn">import</span> <span class="nn">logging</span>
<a name="impress-new.py-pyg.html-4"></a>
<a name="impress-new.py-pyg.html-5"></a><span class="k">class</span> <span class="nc">ImpressFilter</span><span class="p">(</span><span class="n">DexyFilter</span><span class="p">):</span>
<a name="impress-new.py-pyg.html-6"></a>    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;impress&#39;</span><span class="p">]</span>
<a name="impress-new.py-pyg.html-7"></a>    <span class="n">_settings</span> <span class="o">=</span> <span class="p">{</span>
<a name="impress-new.py-pyg.html-8"></a>            <span class="s">&quot;output-extensions&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&quot;.html&quot;</span><span class="p">,</span> <span class="s">&quot;.tex&quot;</span><span class="p">],</span>
<a name="impress-new.py-pyg.html-9"></a>            <span class="s">&quot;help&quot;</span> <span class="p">:</span> <span class="s">&quot;Wraps each separate paragraph in a div for impress.js&quot;</span>
<a name="impress-new.py-pyg.html-10"></a>            <span class="p">}</span>
<a name="impress-new.py-pyg.html-11"></a>
<a name="impress-new.py-pyg.html-12"></a>    <span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_text</span><span class="p">):</span>
<a name="impress-new.py-pyg.html-13"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s">&quot;.html&quot;</span><span class="p">:</span>
<a name="impress-new.py-pyg.html-14"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_text_to_html</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
<a name="impress-new.py-pyg.html-15"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s">&quot;.tex&quot;</span><span class="p">:</span>
<a name="impress-new.py-pyg.html-16"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_text_to_latex</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
<a name="impress-new.py-pyg.html-17"></a>        <span class="k">else</span><span class="p">:</span>
<a name="impress-new.py-pyg.html-18"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="o">.</span><span class="n">ext</span><span class="p">)</span>
<a name="impress-new.py-pyg.html-19"></a>
<a name="impress-new.py-pyg.html-20"></a>    <span class="k">def</span> <span class="nf">process_text_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_text</span><span class="p">):</span>
<a name="impress-new.py-pyg.html-21"></a>        <span class="n">markdown_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;MARKDOWN&#39;</span><span class="p">)</span>
<a name="impress-new.py-pyg.html-22"></a>        <span class="n">markdown_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">wrapper</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a name="impress-new.py-pyg.html-23"></a>
<a name="impress-new.py-pyg.html-24"></a>        <span class="c"># initialize markdown parser</span>
<a name="impress-new.py-pyg.html-25"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;nl2br&#39;</span><span class="p">])</span>
<a name="impress-new.py-pyg.html-26"></a>
<a name="impress-new.py-pyg.html-27"></a>        <span class="n">slides</span> <span class="o">=</span> <span class="p">[]</span>
<a name="impress-new.py-pyg.html-28"></a>        <span class="k">for</span> <span class="n">div_counter</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">&quot;</span><span class="p">)):</span>
<a name="impress-new.py-pyg.html-29"></a>            <span class="n">html</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">slide</span><span class="p">)</span>
<a name="impress-new.py-pyg.html-30"></a>            <span class="n">slides</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;div class=&quot;slide step&quot; id=&quot;slide</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&lt;/div&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">div_counter</span><span class="p">,</span> <span class="n">html</span><span class="p">))</span>
<a name="impress-new.py-pyg.html-31"></a>
<a name="impress-new.py-pyg.html-32"></a>        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slides</span><span class="p">)</span>
</pre></div>
